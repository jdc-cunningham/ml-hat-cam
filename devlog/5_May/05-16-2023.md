7:53 AM

Ahh man I woke up way too early for some reason...

Anyway nexus point in life, another tech job or labor

Either way time moves on... I realized since most jobs now are against being remote I won't have the opportunity to visit the park on weekdays/will be gone 9-5 M-F entire days...

So I gotta get this thing working/take it out to the field tomorrow (nice weather)

I fixed the Vortex 3 already, I crashed it again... the radio went dead or something as it just went into a flat dive, I wasn't even that far away or high up so it was odd... I'm thinking the battery I was using was bad?... I need to test them pull 300mA and see if they can sustain it, that's half the current rating of the battery

Things I need to address immediately:

- record to USB
- setup record button
- fixed focus
  - tie to voice command
- fix autofocus

I have a hunch on what to do (take the buffer stream and write to to a file) but not sure how

https://raspberrypi-guide.github.io/electronics/image-and-video-recording#pirecorder

well it's built into the picamera module

of course in this case it's put into a video stream vs. to file

I probably can write a separate file to do camera recording stuff, although I still need to extract frames to do autofocus... which I want bare minimum, actually use it as a video camera

So just focus on writing to file and photo is in focus (preview on OLED is too much work)

<img src="../images/05162023__working-on-video-recording.JPG"/>

yeap... nice company I left like a dummy, six figs to nothing

8:12 AM

Distracted, saw someone starred a repo of mine, updated readme

The hat cam may die soon since I haven't charged it lately... I can still keep going with a single battery I have on the side while the two main ones charge.

Parallel batteries is cool and each cell is protected

I think there is a pretty good size SD card on the RPi but I'm trying to avoid using it due to shortening its life span

8:20 AM

still distracted... okay write to file

this is a 128GB sd card

`lsblk` shows the 32GB USB drive as `/dev/sda` probably

8:25 AM

hmm... I should find a way to mount the remote volume (RPi) into vscode

so I write code in both places

8:36 AM

lol would think this is obvious but I guess not

https://forums.raspberrypi.com/viewtopic.php?t=332681

OS GUI makes it easy

oh okay it's not bad, need sudo and then the `/mount` path is the actual path you use to write with

looking at this too

https://datasheets.raspberrypi.com/camera/picamera2-manual.pdf

ooh... let's see our first video

<img src="../images/05162023__not-focused-first-video.JPG"/>

Nice

8:48 AM

the use of sudo is not great, looking into it

https://stackoverflow.com/questions/3738173/why-does-pyusb-libusb-require-root-sudo-permissions-on-linux

hmm so far not working

where did I put the systemd stuff, maybe it's already running as root

it's in /etc/systemd/system/boot_ml-hat-cam.service

nope it's pi user dang

8:59 AM

well... lazy fix but gotta get it done/personal project

so it's

- mount usb
- record video

the audio control is off right now

I don't have audio recording

for the moment I won't use... I'm not sure if the audio stream can be listened to by multiple things... probably

but for now I will not use the voice control, will use dedicated audio recording... will sync by visual reference eg. snapping fingers

then merge post process... this thing just needs to work...

I will pre-program close, mid, far range zooms then have a menu to trigger those and start/stop recording

I'm trying to get bare minimum stuff functional here because I will go tomorrow

I'm tired right now and can't really do anything challenging

I got fast food yesterday and I'm coughing... hope I didn't catch a bug, hoping it's just low sleep

9:04 AM

https://makersportal.com/blog/2018/8/23/recording-audio-on-the-raspberry-pi-with-python-and-a-usb-microphone

looks straightforward to record audio

my USB is either 3 or 0, I think it's 3

not sure how to read this `(hw:3, 0)`

USB Lavalier Microphone

I'm mostly using this audio code as is since it's a lot of definitions

9:17 AM

holy crap that's not bad! listening to some I Mother Earth

I need the entire process still

I could change zoom while recording... reach up and push the button lol

play a sound

so... push record, zoom settings displayed

up/down to change

the menu thing is not easy to work on since it's tied to existing boot code... it's one file though but yeah, gotta go in there, figure all that out, tie to code

still need to do the lense focusing

default to wide open/close

9:24 AM

hmm... this is going to take some work

do the hardest stuff first... as brain deteriorates

9:33 AM

I might have broken something with recent changes, boot wise anyway

probably the root systemd change

9:39 AM

oh I see... switching users packages are missing

10:03 AM

quick food break back on

I didn't set the "charged" option to yes so it said "low battery" ha that's cool

trying to figure out the easiest thing to do here, I still have to do those presets

button to record

main button says start

10:32 AM

another brief break

Okay the state is pretty easy

- start/stop record
  - close, middle, far

so you hit "start", goes into the second step with those three options

I had to sell my RM2 so sad... but I have a galaxy book 4K with a pen, will see how that goes

I also want to set the percentage to hours/minutes at some point

it's around 6 hours of battery life if I remember

oh man... the arrows are fixed bound right now

all the menu items are manually drawn

well I can expand on the `parse_dpad()` listener

hmm dMenu also doesn't seem abstract enough/general purpose

10:57 AM

man I'm tired... trying to finish this today but could take an hour or two tomorrow morning worst case

11:12 AM

display is bugging out

weird refresh

the code running on the display is cached it seems... wonder if it's from the boot script

I could disable it temporarily

copy

`sudo systemctl disable boot_ml-hat-cam.service`

11:18 AM

okay it's working correctly now

11:21 AM

okay I'm going to get the menu system working

then write the actual code to move the steppers to position

I figured out the values before but I'll have to get them again... (steppers may have moved)

means watching live stream, keeping focus far distance (high f number)

then add wrappers to the video/audio recorders... bind to the buttons

should be done?...

I can merge the audio in kdenlive, you could use ffmpeg/do it on rpi

11:41 AM

damn it's stuck on far

oh no... I wonder if this is a class/old variable reference thing

11:48 AM

oh man it's working fine I'm dumb...

need to remove the double active colors it is confusing

11:53 AM

oh yeah... instead of repainting the display can just draw over/update individual menu

Which... I'm not sure if that's okay to do because if you have different text they will merge/look bad

the refresh rate is just slow is the issue with a full display clear

now I hope I abstracted the zoom go to functions where it subtracts existing distances/goes to where you want to go based on current steps

it should... since the positions are logged in db

okay I'll get the recording wrappers done now

where's my task list

I've got like half an hour left until an interview

if I don't get this job I'm f'd lol gonna go stack boxes for JB

I may have time but I'm pretty much out of money at this point, can sell things but yeah, sold most things already

12:14 PM

back from brief workout, lol done in 5-10 mins

single 18650 batt died, other two charging

2:01 PM

hmm... interview went well but there were some doubts (overqualified)

I will see... maybe I will be a box stacker once again

I could use the weight loss honestly been a chonk mf

let's go... get it done

I need to test that these wrappers work

ahh damn the device changes eg. `/dev/sda1` vs. `/dev/sdb1`

2:31 PM

yeah if I don't get it I know why... should say "this is the role for me, I love it, etc..."

oh well, I'll deal with reality after tomorrow afternoon

I'm testing the video/audio recording, need to bind as a simple function

2:40 PM

does it work...

tomorrow will be a cool video, field test lol

ahh dang using time wrong

oh no... it's the loop, single threaded dang it... gotta thread it

not sure if I need threads, will see

yeah it's stuck... needs a thread

3:21 PM

currently stuck on this error

`OSError: [Errno -9999] Unanticipated host error`

from alsa

3:24 PM

I think I know the issue... the starter code had a fixed recording time which is used to build the buffer... I could set it to a capped size and see if that fixes it, if so, I either transform the frames or record in chunks

3:26 PM

yeah... that worked hmm

how do I make it dynamic length or auto record chunks

this is not a good approach, using several recordings... it will be stopped inevitably

man I don't have the time to figure this out... I'll record in 1 minute chunks

I will need an ffmpeg script at some point to join all these files

3:32 PM

I still have to do the fixed focus positions

ooh new error

Device unavailable

I'll bring my small chromebook to the field, make sure files are getting written, should be handled by RPi but missing code

3:48 PM

nice, segmentation fault feel like that's an achievement

3:52 PM

him this recursion code is not going well

3:57 PM

nice that's working

4:03 PM

holy crap i got a malloc error lol nice

`malloc(): unsorted double linked list corrupted`

oh damn lol the file name is literally appending vs upgrading

```
1684270011.h264                  1684270479_1_2_3_4.wav
1684270011.wav                   1684270479_1_2_3.wav
1684270204.h264                  1684270479_1_2.wav
1684270204.wav                   1684270479_1.wav
1684270479_1_2_3_4_5_6_7_8.wav   1684270479.h264
1684270479_1_2_3_4_5_6_7.wav     1684270479.wav
1684270479_1_2_3_4_5_6.wav      'System Volume Information'
1684270479_1_2_3_4_5.wav
```

oh yeah... bad thing is this will break the whole code/UI stops functioning

need a nice try catch around it

4:48 PM

distracted, said I'd game with a friend, I'm potentially selling my 3080Ti so I'm trying to get my old SFF setup with my 1050Ti

4:56 PM

got that install going... need to get the values for the zoom, then make functions for that, I could wrap this up later tonight/tomorrow

5:01 PM

I want to finish this but kind of spent

9:30 PM

hoo man I am spent, but I will keep going

I did cycle through the batteries and 1 of them was bad...

now down to 3, about 60-70mins of flight

well... idk but I used a constant draw of 300mA and the batteries lasted between 20-30 mins

the aircraft is not constantly pulling that but the spike in current can exceed 300 eg. 330mA

I did bring an HDMI monitor (small one for cameras) and a wired keyboard as resque/confirm this thing is working

I have a window to fly tomorrow between 10AM and 1PM regarding wind direction

I could wrap this work up tomorrow morning provided I get up around 9AM

I'm still missing

- [ ] zoom control
  - [x] get stepper settings for: near, mid, far (focus, tele)
    - near: 290, 0
    - mid: 170, 150
    - far: 30, 300
  - [x] bind dpad buttons to stepper
  - [ ] check works while recording
  - [ ] add TTS (so I can hear zoom level)

my eyes are burning but I can do this, not discovery work

I can do final checks work tomorrow

9:48 PM

ugh... these names are confusing that I made (lol) focus_near vs. focus_far...

9:50 PM

did have a thought, I should put this thing in a box to carry it safely vs. stuffing it in the bag of gear, I will do that

if I wasn't insecure I'd just wear it ha but I am insecure

9:57 PM

the error will have to get addressed with the audio

10:04 PM

hmm... the focus can get lost (due to loose stepper/not fixed)

That's where the autozoom comes in with variance diffing but not enabled right now

I have to get the values again dang

I popped the focus stepper out/repositioned it is the issue

also the .h264 is problematic for me I need to convert it to mp4

which is fine just post-processing stuff

https://forums.raspberrypi.com/viewtopic.php?t=72532

seg fault lol damn

10:22 PM

I have to fix this stop recording issue because I have to restart the entire pi if not

10:35 PM

hmm... this is not working

when it fails to stop the audio it breaks the whole script so the dpad stops working and all that

I have a thought which is nasty... record in short 10s chunks... so it will stop eventually, but that's a lot of small files

running into seg fault

10:45 PM

my man is out of gas (need to recharge batteries)

I actually left it on turns out hanging on the wall during the break above

10:49 PM

haha... it works once but not twice

video has problems too

hmm it can capture up to 4K but wondering should I...

1080P could work...

yeah 4K probably not

https://forums.raspberrypi.com/viewtopic.php?t=281095

I want at least 30fps 60fps preferred for motion

1080P is 60fps, will stick with that

11:00 PM

```
sudo apt-get install gpac
MP4Box  -fps 30  -add infile.h264 outfile.mp4
```

process files

11:04 PM

my 1080P file became 720P hmm

11:14 PM

I do need a message that says "stopping recording"

11:26 PM

ahh man I still have to get the stepper values again and play sound

will see if ugprading helps it

11:31 PM

I need to move on

yeap... still 720p

okay... I need to reset the steppers and verify they work

pos now

(focus, tele)

- near: 320, 0
- mid: 210, 150
- far: 70, 300

the autofocus figuring this out on its own would be nice

vs. old

- near: 290, 0
- mid: 170, 150
- far: 30, 300

oof...

oh okay it is possible 350, 300 max positions

11:47 PM

dang it's blurry

this is where the autovariance comes in but I don't have that algo working right

it could be the distance...

I focused it for very far... I did not consider the fstop

I assumed far away meant high fstop

11:51 PM

this footage is going to be so bad... the bumpiness

I'm going to tweak the steps

11:56 PM

I can tweak this tomorrow, need to add the audio callout

